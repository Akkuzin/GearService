var app=angular.module("mainModule",["gettext","ui.utils","ui.router","angularMoment","ngMaterial","mdDateTime","md.data.table","angular-loading-bar","templates","angular-cache"]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("cheque",{"abstract":!0,url:"/cheques",views:{header:{controller:["$rootScope","$scope","$state",function(a,b,c){b.selectedTab=c.current.data.selectedTab,a.$on("$stateChangeSuccess",function(a,c,d,e,f){b.selectedTab=c.data.selectedTab})}],template:'<header selected-tab="selectedTab"></header>'},content:{template:"<ui-view></ui-view>"}}}).state("cheque.filter",{url:"^/filter",template:"<filters-page></filters-page>",data:{selectedTab:0}}).state("cheque.edit",{url:"^/cheque/{chequeId:[0-9]{1,10}}",controller:["$scope","$stateParams",function(a,b){a.chequeID=b.chequeId}],template:'<cheque-page cheque-id="chequeID"></cheque-page>',data:{selectedTab:1}}).state("cheque.create",{url:"^/cheque",template:"<cheque-page></cheque-page>",data:{selectedTab:1}}),b.when("","/filter"),b.otherwise("/filter")}]).config(["$mdThemingProvider",function(a){a.theme("payment").primaryPalette("grey",{"default":"50"}).accentPalette("pink").warnPalette("red"),a.theme("header").primaryPalette("grey",{"default":"900"}).accentPalette("indigo")}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1,a.latencyThreshold=100}]).run(["gettextCatalog","amMoment",function(a,b){a.setCurrentLanguage("ru"),b.changeLocale("ru")}]);angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("ru",{Address:"Адрес","Change cheque №":"Изменить расписку №",notes:"Специальные отметки","Create New Check":"Новая расписка",Customer:"Заказчик",Email:"Почта",Guarantee:"Гарантия",help:"Помощь",Home:"Главная",Id:"№",Inspector:"Принял",Introduced:"Прием",IntroducedFrom:"Принят с",IntroducedTo:"Принят по",Issued:"Выдан",Kits:"Комплект",Malfunction:"Неисправность",master:"Инженер",Model:"Модель","Modify Check":"Править","Name of Product":"Наименование",No:"Нет","Number of pages":"Количество страниц",Phone:"Телефон",profile:"Профиль",Purchaser:"Сдал",Ready:"Готов","Repair Period":"Срок ремонта",Send:"Добавить","Serial Number":"Серийный номер",settings:"Настройки","Special Notes":"Особые отметки",diagnostics:"Диагностика",Yes:"Да",Filters:"Фильтры",Checks:"Расписки",Create:"Создать","Change cheque":"Изменить расписку",Now:"Сейчас",Cancel:"Закрыть",Save:"Ок",Cheque:"Расписка",added:"добавлена",modified:"изменена",deleted:"удалена","Has guarantee":"Есть гарантия","Has no guarantee":"Нет гарантии","Not ready":"Не готов","Not issued":"Не выдан","Rows per page:":"Строк на странице:",of:"из",tasks:"Задачи",login:"Войти",dashboard:"Рабочий стол",analytics:"Аналитика",synchronize:"Синхронизировать","enter date":"Введите дату",cheque:"Расписка",paid:"Оплачен","not paid":"Не оплачен",payment:"Оплата",repair:"Ремонт",zip:"ЗИП",deliver:"Доставка",prepayment:"Предоплата",type:"Тип",description:"Описание",cost:"Стоимость",currency:"Валюта",sum:"Сумма","sum with prepayment":"Сумма с учетом предоплаты",prediction:"Ориентировочная цена","current currency rates":"Курс валют на"})}]),angular.module("mainModule").controller("TimePicker",["$scope",function(a){a.$watch("time",function(b,c){void 0==b?(a.hours=void 0,a.minutes=void 0):(a.hours=moment(b).format("HH"),a.minutes=moment(b).format("mm"))}),a.$watch("hours",function(b,c){void 0!=b&&(a.time=moment(a.time).hours(b).format("YYYY-MM-DDTHH:mm:ssZZ"))}),a.$watch("minutes",function(b,c){void 0!=b&&(a.time=moment(a.time).minutes(b).format("YYYY-MM-DDTHH:mm:ssZZ"))})}]).directive("timePicker",function(){return{restrict:"E",controller:"TimePicker",scope:{time:"=ngModel"},require:"ngModel",templateUrl:"directives/time-picker/time-picker.html"}}),angular.module("mainModule").controller("DatePicker",["$scope",function(a){a.$watch("date",function(b,c){void 0==b?a.dateInner=void 0:a.dateInner=moment(b).toDate()}),a.$watch("dateInner",function(b,c){void 0!=b&&(a.date=moment(b).format("YYYY-MM-DDTHH:mm:ssZZ"))})}]).directive("datePicker",function(){return{restrict:"E",controller:"DatePicker",scope:{date:"=ngModel"},require:"ngModel",templateUrl:"directives/date-picker/date-picker.html"}}),angular.module("mainModule").controller("DateTimePicker",["$scope",function(a){a.$watch("datetime",function(b,c){void 0==b?(a.datetimeinner=void 0,a.date=void 0,a.time=void 0):(a.date=moment(b).toDate(),a.time=moment(b).toDate())}),a.$watch("date",function(b,c){if(void 0!=b){var d=moment(a.datetime).hours(),e=moment(a.datetime).minutes();a.datetime=moment(b).hours(d).minutes(e).format("YYYY-MM-DDTHH:mm:ssZZ")}}),a.$watch("time",function(b,c){if(void 0!=b){var d=moment(b).hours(),e=moment(b).minutes();a.datetime=moment(a.datetime).hours(d).minutes(e).format("YYYY-MM-DDTHH:mm:ssZZ")}})}]).directive("dateTimePicker",function(){return{restrict:"E",controller:"DateTimePicker",scope:{datetime:"=ngModel"},require:"ngModel",templateUrl:"directives/date-time-picker/date-time-picker.html"}}),angular.module("mainModule").directive("printCheque",function(){return{restrict:"E",controller:["$scope",function(a){var b={office:{office:!0,tech:!1,client:!1},tech:{office:!1,tech:!0,client:!1},client:{office:!1,tech:!1,client:!0}};a.spec=b[a.specialization],a.getKits=function(){var b=[];return a.cheque.kits.forEach(function(a){b.push(a.text)}),b.join(", ")}}],scope:{cheque:"=ngModel",specialization:"=specialization"},require:["ngModel","specialization"],templateUrl:"app/cheque-page/print-cheque/print-cheque.html"}}),angular.module("mainModule").controller("FiltersPage",["$scope","$http","$timeout","$mdDialog","gettextCatalog",function(a,b,c,d,e){a.filterForm={},a.cleanFilter={order:"-id",limit:15,page:1,nameOfCustomer:"",nameOfProduct:"",model:"",serialNumber:"",purchaserName:"",inspectorName:"",masterName:"",introducedFrom:void 0,introducedTo:void 0},a.label={text:e.getString("Rows per page:"),of:e.getString("of")},a.getAllCheques=function(){b.get("/cheques").success(function(b){a.cheques=b})},a.resetFilter=function(){a.filter=angular.copy(a.cleanFilter),a.filterForm.$setPristine()},a.onPageChange=function(){},a.onOrderChange=function(){},a.filter=angular.copy(a.cleanFilter),a.getAllCheques()}]).directive("filtersPage",function(){return{restrict:"E",controller:"FiltersPage",templateUrl:"app/filters-page/filters-page.html"}}),angular.module("mainModule").filter("filterByDateRange",[function(){return function(a,b,c){if(null==b&&null==c)return a;var d=null!=b?moment(b).unix():moment("1899-12-31T21:00:00.000Z").unix(),e=null!=c?moment(c).unix():moment("2999-12-31T21:00:00.000Z").unix(),f=null,g=[];return angular.forEach(a,function(a){f=moment(a.introduced).unix(),f>d&&e>f&&g.push(a)}),g}}]),angular.module("mainModule").filter("filterByID",[function(){return function(a,b){if(null==b||""==b)return a;var c=[];return angular.forEach(a,function(a){b==a.id&&c.push(a)}),c}}]),angular.module("mainModule").controller("Header",["$scope","currencyRatesService","$mdToast",function(a,b,c){a.currencyDate=function(){return moment(a.rates.id).format("ll")},b.getCurrencyRates().then(function(b){a.rates=b}),a.refreshCurrencyRates=function(){console.log("1241241"),b.refreshCurrencyRates().then(function(b){a.rates=b,c.show(c.simple().content("Currency rates refreshed").position("top right").hideDelay(700))})}}]).directive("header",function(){return{restrict:"E",controller:"Header",scope:{selectedTab:"=selectedTab"},require:"selectedTab",templateUrl:"app/header/header.html"}}),angular.module("mainModule").controller("CommentsBlock",["$scope","$http",function(a,b){a.comment=void 0,a.saveComment=function(){b.post("/cheques/"+a.cheque.id+"/"+a.title,a.comment).success(function(){a.comment.text=void 0,a.form.$setPristine(),a.form.$setUntouched(),a.getCheque()})},a.deleteComment=function(c){b["delete"]("/cheques/"+a.cheque.id+"/"+a.title+"/"+c).success(function(){a.getCheque()})},a.getCheque=function(){b.get("/cheques/"+a.cheque.id).success(function(b){a.cheque=b})}}]).directive("commentsBlock",[function(){return{restrict:"E",controller:"CommentsBlock",scope:{cheque:"=ngModel",title:"=title"},require:"ngModel",templateUrl:"app/cheque-page/comments-block/comments-block.html"}}]),angular.module("mainModule").controller("PaymentBlock",["$scope","currencyRatesService",function(a,b){a.hasPrepayment=!1,a.addPayment=function(){void 0===a.cheque.payments&&(a.cheque.payments=[]),b.refreshCurrencyRates().then(function(b){a.cheque.payments.push({cost:0,currentCurrency:"rub",currency:b})})},a.delPayment=function(b){a.cheque.payments.splice(a.cheque.payments.indexOf(b),1)},a.sum=function(b,c){var d=0;return a.hasPrepayment=!1,void 0!=a.cheque.payments&&a.cheque.payments.forEach(function(e){void 0!=e.cost&&void 0!=e.currentCurrency&&("prepayment"!=e.type?d+=e.cost*e.currency[e.currentCurrency]/e.currency[b]:(a.hasPrepayment=!0,c&&(d-=e.cost*e.currency[e.currentCurrency]/e.currency[b])))}),d}}]).directive("paymentBlock",[function(){return{restrict:"E",controller:"PaymentBlock",scope:{cheque:"=ngModel"},require:"ngModel",templateUrl:"app/cheque-page/payment-block/payment-block.html"}}]),angular.module("mainModule").controller("ChequeForm",["$scope","$http","gettextCatalog","$mdToast","$state",function(a,b,c,d,e){a.getCheque=function(){b.get("/cheques/"+a.cheque.id).success(function(b){a.cheque=b})},a.sendCheque=function(){b.post("/cheques",a.cheque).success(function(b){a.cheque=b,a.form.$setPristine(),a.form.$setUntouched(),d.show(d.simple().content(c.getString("Cheque")+" "+c.getString("added")).position("top right").hideDelay(700))})},a.deleteCheque=function(){b["delete"]("/cheques/"+a.cheque.id).success(function(){e.go("cheque.filter"),d.show(d.simple().content(c.getString("Cheque")+" №"+a.cheque.id+" "+c.getString("deleted")).position("top right").hideDelay(700))})},a.addKit=function(a){return{text:a}},a.printCheque=function(){window.print()},a.hasID||(a.cleanNewCheck={repairPeriod:99,introduced:moment().format("YYYY-MM-DDTHH:mm:ssZZ"),inspectorName:"Администратор",kits:[],notes:[],payments:[],diagnostics:[]},a.resetNewCheck=function(){a.cheque=angular.copy(a.cleanNewCheck)},a.resetNewCheck()),a.$watch("form.$dirty",function(b,c){a.hasUnsavedChange=b})}]).directive("chequeForm",[function(){return{restrict:"E",controller:"ChequeForm",scope:{cheque:"=ngModel",hasID:"=hasId"},require:["ngModel","hasId"],templateUrl:"app/cheque-page/cheque-form/cheque-form.html"}}]),angular.module("mainModule").controller("ChequePage",["$scope","$stateParams","$http",function(a,b,c){a.cheque={kits:[],payments:[],phone:"",email:""},a.hasID=!1,a.getCheque=function(b){c.get("/cheques/"+b).success(function(b){a.cheque=b})},a.$watch("cheque.id",function(b,c){a.hasID=!!b}),a.chequeID&&a.getCheque(a.chequeID)}]).directive("chequePage",function(){return{restrict:"E",controller:"ChequePage",scope:{chequeID:"=chequeId"},templateUrl:"app/cheque-page/cheque-page.html"}}),angular.module("mainModule").controller("PaymentLine",["$scope",function(a){a.hasPrepayment=!1,a.types=["repair","zip","deliver","prepayment"],a.masters=["kosoy","valikozz"],a.currencies=["eur","uah","usd","rub"],a.$watch("payment.type",function(b,c){a.hasPrepayment="prepayment"===b}),a.toPay=function(b){return a.payment.cost*a.payment.currency[a.payment.currentCurrency]/a.payment.currency[b]}}]).directive("paymentLine",[function(){return{restrict:"E",controller:"PaymentLine",scope:{payment:"=payment",paid:"=paid"},require:["ngModel","paid"],templateUrl:"app/cheque-page/payment-block/payment-line/payment-line.html"}}]),angular.module("mainModule").service("currencyRatesService",["CacheFactory","$http","$q",function(a,b,c){var d;return a.get("currencyRatesCache")||a.createCache("currencyRatesCache",{deleteOnExpire:"aggressive",maxAge:288e5,recycleFreq:6e4,storageMode:"localStorage",onExpire:function(a,c){b.get(a).success(function(b){d.put(a,b)})}}),d=a.get("currencyRatesCache"),{getCurrencyRates:function(){var a=c.defer();return b.get("/currency-rates",{cache:d}).success(function(b){a.resolve(b)}),a.promise},refreshCurrencyRates:function(){var a=c.defer();return d.remove("/currency-rates"),b.get("/currency-rates",{cache:d}).success(function(b){a.resolve(b)}),a.promise}}}]);