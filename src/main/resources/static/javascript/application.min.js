var app=angular.module("mainModule",["gettext","ui.utils","ui.router","angularMoment","ngMaterial","mdDateTime","md.data.table","angular-loading-bar","AngularPrint"]).config(["$stateProvider",function(a){a.state("cheque",{"abstract":!0,url:"/cheques",views:{header:{controller:"HeaderController",templateUrl:"/header"},content:{template:"<ui-view></ui-view>"}}}).state("cheque.filter",{url:"^/filter",controller:"MainController",templateUrl:"/filters",data:{selectedTab:0,disabledEdit:!0}}).state("cheque.edit",{url:"/{chequeId:[0-9]{1,10}}",controller:"EditController",templateUrl:"/edit",data:{selectedTab:1,disabledEdit:!1}}).state("cheque.create",{url:"^/create",controller:"CreateController",templateUrl:"/create",data:{selectedTab:2,disabledEdit:!0}})}]).config(["$urlRouterProvider",function(a){a.when("","/filter"),a.otherwise("/filter")}]).config(["$mdThemingProvider",function(a){a.theme("header","default").accentPalette("indigo")}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1,a.latencyThreshold=100}]).run(["gettextCatalog","amMoment",function(a,b){a.setCurrentLanguage("ru"),b.changeLocale("ru")}]);app.controller("CreateController",["$scope","$http","$state","$filter","$mdToast","gettextCatalog",function(a,b,c,d,e,f){a.cleanNewCheck={repairPeriod:99,introduced:moment().format("YYYY-MM-DDTHH:mm:ssZZ"),inspectorName:"Администратор",kits:[],notes:[],diagnostics:[]},a.resetNewCheck=function(){a.cheque=angular.copy(a.cleanNewCheck)},a.sendCheque=function(){null!=a.note&&a.cheque.notes.push(a.note),null!=a.diagnostic&&a.cheque.diagnostics.push(a.diagnostic),b.post("/cheques",a.cheque).success(function(){c.go("cheque.filter"),e.show(e.simple().content(f.getString("Cheque")+" "+f.getString("added")).position("top right").hideDelay(700))})},a.addKit=function(a){return{text:a}},a.resetNewCheck()}]),app.controller("EditController",["$scope","$stateParams","$http","$state","$filter","$compile","$mdToast","gettextCatalog","$rootScope",function(a,b,c,d,e,f,g,h,i){a.cheque={kits:[],payments:[],phone:"",email:""},a.getCheque=function(){c.get("/cheques/"+b.chequeId).success(function(b){a.cheque=b})},a.modifyCheque=function(){c.post("/cheques/"+b.chequeId,a.cheque).success(function(){d.go("cheque.filter"),g.show(g.simple().content(h.getString("Cheque")+" №"+a.cheque.id+" "+h.getString("modified")).position("top right").hideDelay(700))})},a.deleteCheque=function(){c["delete"]("/cheques/"+b.chequeId).success(function(){d.go("cheque.filter"),g.show(g.simple().content(h.getString("Cheque")+" №"+a.cheque.id+" "+h.getString("deleted")).position("top right").hideDelay(700))})},a.saveDiagnostic=function(){c.post("/cheques/"+b.chequeId+"/diagnostic",a.diagnostic).success(function(){a.diagnostic.text=void 0,a.diagnostics.$setPristine(),a.diagnostics.$setUntouched(),a.getCheque()})},a.removeDiagnostic=function(d){c["delete"]("/cheques/"+b.chequeId+"/diagnostic/"+d).success(function(){a.getCheque()})},a.saveNote=function(){c.post("/cheques/"+b.chequeId+"/note",a.note).success(function(){a.note.text=void 0,a.notes.$setPristine(),a.notes.$setUntouched(),a.getCheque()})},a.removeNote=function(d){c["delete"]("/cheques/"+b.chequeId+"/note/"+d).success(function(){a.getCheque()})},a.addKit=function(a){return{text:a}},a.addPayment=function(){void 0===a.cheque.payments&&(a.cheque.payments=[]),a.cheque.payments.push({description:void 0,cost:0,currency:"RUB"})},a.sumRUB=function(){var b=0;return void 0!=a.cheque.payments&&a.cheque.payments.forEach(function(a){void 0!=a.cost&&void 0!=a.currency&&(b+=a.cost*i.rates[a.currency])}),b},a.currencies=function(){return Object.keys(i.rates)},a.delPayment=function(b){a.cheque.payments.splice(a.cheque.payments.indexOf(b),1)},a.printCheque=function(){window.print()},a.types=["Repair","ZIP","Deliver"],a.masters=["Kosoy","Valikozz"],a.getCheque()}]),app.controller("HeaderController",["$scope","$rootScope","$http","$mdToast",function(a,b,c,d){a.data={},b.rates={},a.getCurrencyRate=function(){c.get("/currency-rates").success(function(a){b.rates=a})},a.$on("$stateChangeSuccess",function(b,c){a.data.selectedIndex=c.data.selectedTab,a.data.disabledEdit=c.data.disabledEdit}),a.getCurrencyRate()}]),app.controller("MainController",["$scope","$http","$timeout","$mdDialog","gettextCatalog",function(a,b,c,d,e){a.filterForm={},a.cleanFilter={order:"-id",limit:15,page:1,nameOfCustomer:"",nameOfProduct:"",model:"",serialNumber:"",purchaserName:"",inspectorName:"",masterName:"",introducedFrom:void 0,introducedTo:void 0},a.label={text:e.getString("Rows per page:"),of:e.getString("of")},a.getAllCheques=function(){c(function(){b.get("/cheques").success(function(b){a.cheques=b})},1e3)},a.resetFilter=function(){a.filter=angular.copy(a.cleanFilter),a.filterForm.$setPristine()},a.onPageChange=function(){},a.onOrderChange=function(){},a.filter=angular.copy(a.cleanFilter),a.getAllCheques()}]),app.directive("dateTimePicker",function(){return{restrict:"E",controller:["$scope",function(a){a.$watch("datetime",function(b,c){void 0==b?(a.datetimeinner=void 0,a.date=void 0,a.time=void 0):(a.date=moment(b).toDate(),a.time=moment(b).toDate())}),a.$watch("date",function(b,c){if(void 0!=b){var d=moment(a.datetime).hours(),e=moment(a.datetime).minutes();a.datetime=moment(b).hours(d).minutes(e).format("YYYY-MM-DDTHH:mm:ssZZ")}}),a.$watch("time",function(b,c){if(void 0!=b){var d=moment(b).hours(),e=moment(b).minutes();a.datetime=moment(a.datetime).hours(d).minutes(e).format("YYYY-MM-DDTHH:mm:ssZZ")}})}],scope:{datetime:"=ngModel"},require:"ngModel",template:'<md-content layout="row">   <md-datepicker ng-model="date" md-placeholder="Enter date"></md-datepicker>   <time-picker ng-model="time"></time-picker></md-content>'}}),app.directive("datePicker",function(){return{restrict:"E",controller:["$scope",function(a){a.$watch("date",function(b,c){void 0==b?a.dateInner=void 0:a.dateInner=moment(b).toDate()}),a.$watch("dateInner",function(b,c){void 0!=b&&(a.date=moment(b).format("YYYY-MM-DDTHH:mm:ssZZ"))})}],scope:{date:"=ngModel"},require:"ngModel",template:'<md-datepicker ng-model="dateInner" style="margin: 0 0.7rem;"></md-datepicker>'}}),app.directive("timePicker",function(){return{restrict:"E",controller:["$scope",function(a){a.$watch("time",function(b,c){void 0==b?(a.hours=void 0,a.minutes=void 0):(a.hours=moment(b).format("HH"),a.minutes=moment(b).format("mm"))}),a.$watch("hours",function(b,c){void 0!=b&&(a.time=moment(a.time).hours(b).format("YYYY-MM-DDTHH:mm:ssZZ"))}),a.$watch("minutes",function(b,c){void 0!=b&&(a.time=moment(a.time).minutes(b).format("YYYY-MM-DDTHH:mm:ssZZ"))})}],scope:{time:"=ngModel"},require:"ngModel",templateUrl:'<md-content layout="row" layout-align="center center" style="margin-left: 10px; font-size: 15px"> <md-input-container style="width: 1.5rem; padding: 8px 0 0 0;">   <input type="text" ng-model="hours" maxlength="2" max="24" ng-model-options="{updateOn: \'blur\'}"> </md-input-container> <span style="padding: 8px 3px 0 3px;">:</span> <md-input-container style="width: 1.5rem; padding: 8px 0 0 0;">   <input type="text" ng-model="minutes" maxlength="2" max="60" ng-model-options="{updateOn: \'blur\'}"> </md-input-container></md-content>'}}),app.directive("printCheque",function(){return{restrict:"E",controller:["$scope",function(a){var b={office:{office:!0,tech:!1,client:!1},tech:{office:!1,tech:!0,client:!1},client:{office:!1,tech:!1,client:!0}};a.spec=b[a.specialization],a.getKits=function(){var b=[];return a.cheque.kits.forEach(function(a){b.push(a.text)}),b.join(", ")}}],scope:{cheque:"=ngModel",specialization:"=specialization"},require:["ngModel","specialization"],templateUrl:"/print"}}),app.filter("filterByDateRange",[function(){return function(a,b,c){if(null==b&&null==c)return a;var d=null!=b?moment(b).unix():moment("1899-12-31T21:00:00.000Z").unix(),e=null!=c?moment(c).unix():moment("2999-12-31T21:00:00.000Z").unix(),f=null,g=[];return angular.forEach(a,function(a){f=moment(a.introduced).unix(),f>d&&e>f&&g.push(a)}),g}}]),app.filter("filterByID",[function(){return function(a,b){if(null==b||""==b)return a;var c=[];return angular.forEach(a,function(a){b==a.id&&c.push(a)}),c}}]),angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("ru",{Address:"Адрес","Change cheque №":"Изменить расписку №",Notes:"Специальные отметки","Create New Check":"Новая расписка",Customer:"Заказчик",Email:"Почта",Guarantee:"Гарантия",help:"Помощь",Home:"Главная",Id:"№",Inspector:"Принял",Introduced:"Прием",IntroducedFrom:"Принят с",IntroducedTo:"Принят по",Issued:"Выдан",Kits:"Комплект",Malfunction:"Неисправность",Master:"Инженер",Model:"Модель","Modify Check":"Править","Name of Product":"Наименование",No:"Нет","Number of pages":"Количество страниц",Phone:"Телефон",profile:"Профиль",Purchaser:"Сдал",Ready:"Готов","Repair Period":"Срок ремонта",Send:"Добавить","Serial Number":"Серийный номер",settings:"Настройки","Special Notes":"Особые отметки",Diagnostics:"Диагностика",Yes:"Да",Filters:"Фильтры",Checks:"Расписки",Create:"Создать","Change cheque":"Изменить расписку",Now:"Сейчас",Cancel:"Закрыть",Save:"Ок",Cheque:"Расписка",added:"добавлена",modified:"изменена",deleted:"удалена","Has guarantee":"Есть гарантия","Has no guarantee":"Нет гарантии","Not ready":"Не готов","Not issued":"Не выдан","Rows per page:":"Строк на странице:",of:"из",tasks:"Задачи",login:"Войти",dashboard:"Рабочий стол",analytics:"Аналитика"})}]);